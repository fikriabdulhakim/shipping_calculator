<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penghitungan Biaya Pengiriman Barang</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Menambahkan jQuery UI CSS -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        /* CSS untuk strikethrough tanggal yang tidak valid */
        .ui-datepicker td.ui-state-disabled {
            text-decoration: line-through;
            color: red;
        }

        /* CSS untuk menambah ukuran font dan styling lainnya pada datepicker */
        .ui-datepicker {
            font-size: 14px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script>
        $(document).ready(function() {
            const validDates = ['2025-04-15', '2025-04-22'];  // Tanggal yang valid dari backend

            // Inisialisasi datepicker
            $("#departure_date").datepicker({
                beforeShowDay: function(date) {
                    // Mendapatkan tanggal dalam format yyyy-mm-dd
                    const dateStr = $.datepicker.formatDate("yy-mm-dd", date);
                    // Menandai tanggal yang tidak valid dengan strikethrough
                    if (validDates.indexOf(dateStr) === -1) {
                        return [false, "ui-state-disabled"];  // Nonaktifkan tanggal dan beri kelas untuk strikethrough
                    }
                    return [true, ""];
                },
                dateFormat: "yy-mm-dd",  // Format tanggal yang digunakan
                minDate: new Date(2025, 3, 15),  // Menetapkan tanggal minimum (15 April 2025)
                maxDate: new Date(2025, 3, 22)  // Menetapkan tanggal maksimum (22 April 2025)
            });
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>Penghitungan Biaya Pengiriman Barang</h1>
        <form method="POST" action="/">
            {{ form.csrf_token }}
            
            <div class="form-group">
                <label for="name">Nama:</label>
                {{ form.name }}
            </div>
            
            <div class="form-group">
                <label for="whatsapp">Nomor Whatsapp:</label>
                {{ form.whatsapp }}
            </div>

            <div class="form-group">
                <label for="item_type">Jenis Barang:</label>
                {{ form.item_type }}
            </div>
            
            <div class="form-group">
                <label for="departure_date">Tanggal Keberangkatan:</label>
                <input type="text" id="departure_date" name="departure_date" required>
            </div>

            <div class="form-group">
                <label for="weight">Berat Barang (kg):</label>
                {{ form.weight }}
            </div>

            <div class="form-group">
                {{ form.submit }}
            </div>
        </form>

        {% if shipping_cost is not none %}
            <h2>Ringkasan Perhitungan:</h2>
            <table border="1" cellpadding="10" cellspacing="0">
                <tr><th>Nama</th><td>{{ name }}</td></tr>
                <tr><th>Nomor Whatsapp</th><td>{{ whatsapp }}</td></tr>
                <tr><th>Jenis Barang</th><td>{{ item_summary }}</td></tr>
                <tr><th>Berat Barang</th><td>{{ weight }} kg</td></tr>
                <tr><th>Tanggal Keberangkatan</th><td>{{ departure_date }}</td></tr>
                <tr><th>Alamat Kurir</th><td>Kettwiger Strasse 15, 45468 Mulheim an der Ruhr</td></tr>
                <tr><th>Peta (Google Maps)</th><td><a href="{{ google_maps_link }}" target="_blank"><button>View on Google Maps</button></a></td></tr>
                <tr><th>Biaya Pengiriman</th><td>â‚¬{{ shipping_cost }}</td></tr>
            </table>
            <h3>Tata Cara Pembayaran:</h3>
            <p>Metode pembayaran dapat dilakukan melalui transfer:</p>
            <p><strong>Nama Bank</strong>: Deutsche Bank</p>
            <p><strong>IBAN</strong>: DE99 0099 9900 0099 0099 99</p>
            <p><strong>Nama Penerima</strong>: Bambang Sudibyo</p>

            <h4>Waktu Transaksi Berakhir: <span id="countdown"></span></h4>

            <button onclick="location.href='/cancel'">Saya tidak jadi memesan</button>
            <button onclick="location.href='/pay'">Saya sudah membayar</button>
        {% else %}
            <p>Silakan masukkan semua data yang diperlukan untuk menghitung biaya pengiriman.</p>
        {% endif %}

    </div>
</body>
</html>
